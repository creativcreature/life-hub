<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #FAFAF8;
            --surface: #FFFFFF;
            --surface-alt: #F5F5F3;
            --border: #E8E8E6;
            --text: #1A1A18;
            --text-muted: #6B6B69;
            --accent: #C19A6B;
            --accent-dark: #A07D52;
            --accent-light: rgba(193, 154, 107, 0.12);
            --success: #2D5A3D;
            --success-light: rgba(45, 90, 61, 0.12);
            --danger: #8B3A3A;
            --danger-light: rgba(139, 58, 58, 0.12);
            --blue: #2563eb;
            --purple: #7c3aed;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0D0D0C;
                --surface: #1A1A18;
                --surface-alt: #242422;
                --border: #333331;
                --text: #F5F5F3;
                --text-muted: #8B8B89;
                --accent-light: rgba(193, 154, 107, 0.15);
                --success-light: rgba(45, 90, 61, 0.2);
                --danger-light: rgba(139, 58, 58, 0.2);
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'DM Sans', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Typography - Editorial Style */
        .serif { font-family: 'Playfair Display', Georgia, serif; }
        .headline-xl { font-family: 'Playfair Display', serif; font-size: clamp(2.5rem, 6vw, 4rem); font-weight: 400; line-height: 1.1; letter-spacing: -0.02em; }
        .headline-lg { font-family: 'Playfair Display', serif; font-size: clamp(1.75rem, 4vw, 2.5rem); font-weight: 400; line-height: 1.2; }
        .headline-md { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 400; }
        .headline-sm { font-family: 'Playfair Display', serif; font-size: 1.25rem; font-weight: 400; }
        .eyebrow { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.15em; color: var(--accent); }
        .body-lg { font-size: 1.125rem; }
        .body-sm { font-size: 0.875rem; }
        .caption { font-size: 0.75rem; color: var(--text-muted); }

        /* Layout */
        .app { min-height: 100vh; }

        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 100;
        }

        .nav-brand { font-family: 'Playfair Display', serif; font-size: 1.25rem; color: var(--accent); }

        .nav-links { display: flex; gap: 0.25rem; }

        .nav-link {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.15s;
            cursor: pointer;
            border: none;
            background: none;
            font-family: inherit;
        }

        .nav-link:hover { color: var(--text); background: var(--surface-alt); }
        .nav-link.active { color: var(--accent); background: var(--accent-light); font-weight: 500; }

        .main { padding-top: 60px; }

        .container { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem; }

        .panel { display: none; }
        .panel.active { display: block; }

        /* Cards */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-flush { border-radius: 0; border-left: none; border-right: none; }
        .card-accent { border-left: 3px solid var(--accent); }
        .card-gold { background: var(--accent-light); border-color: var(--accent); }
        .card-success { background: var(--success-light); border-color: var(--success); }
        .card-danger { background: var(--danger-light); border-color: var(--danger); }

        /* Grid */
        .grid { display: grid; gap: 1.5rem; }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }

        @media (max-width: 900px) {
            .grid-3, .grid-4 { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .nav-links { display: none; }
            .container { padding: 2rem 1rem; }
        }

        /* Stats */
        .stat { font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 400; line-height: 1; }
        .stat-lg { font-size: 3.5rem; }
        .stat-sm { font-size: 1.75rem; }
        .stat-gold { color: var(--accent); }
        .stat-success { color: var(--success); }
        .stat-danger { color: var(--danger); }

        /* Progress */
        .progress { height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; margin: 0.75rem 0; }
        .progress-fill { height: 100%; border-radius: 3px; transition: width 0.3s ease; }
        .progress-fill.gold { background: var(--accent); }
        .progress-fill.success { background: var(--success); }
        .progress-fill.danger { background: var(--danger); }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            font: inherit;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn:hover { border-color: var(--accent); }
        .btn-primary { background: var(--accent); border-color: var(--accent); color: #fff; }
        .btn-primary:hover { background: var(--accent-dark); }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; }
        .btn-ghost { background: transparent; border-color: transparent; }
        .btn-ghost:hover { background: var(--surface-alt); }
        .btn-block { width: 100%; }
        .btn-danger { background: var(--danger); border-color: var(--danger); color: #fff; }

        /* Forms */
        input, select, textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            font: inherit;
            font-size: 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            transition: border-color 0.15s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        textarea { resize: vertical; min-height: 80px; }

        label { display: block; font-size: 0.85rem; font-weight: 500; margin-bottom: 0.5rem; }

        /* Quick Add Grid */
        .quick-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 0.5rem; }

        .quick-btn {
            padding: 1rem 0.5rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .quick-btn:hover { border-color: var(--accent); background: var(--accent-light); }
        .quick-btn .amount { font-family: 'Playfair Display', serif; font-size: 1.25rem; display: block; }
        .quick-btn .cat { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

        /* Expense List */
        .expense-list { max-height: 400px; overflow-y: auto; }

        .expense-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .expense-item:last-child { border-bottom: none; }

        .expense-cat-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .expense-info { flex: 1; }
        .expense-amount { font-weight: 600; color: var(--danger); }
        .expense-delete { opacity: 0; transition: opacity 0.15s; }
        .expense-item:hover .expense-delete { opacity: 1; }

        /* Category Bar */
        .cat-bar { display: flex; height: 8px; border-radius: 4px; overflow: hidden; margin: 1rem 0; }
        .cat-bar-seg { height: 100%; transition: width 0.3s; }

        .cat-legend { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.75rem; }
        .cat-legend-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.8rem; }

        /* Checkboxes */
        .check-list { display: grid; gap: 0.5rem; }

        .check-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .check-item:hover { border-color: var(--accent); }
        .check-item.done { background: var(--success-light); border-color: var(--success); }
        .check-item.done .check-text { text-decoration: line-through; opacity: 0.6; }

        .check-box {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .check-item.done .check-box {
            background: var(--success);
            border-color: var(--success);
        }

        .check-item.done .check-box::after {
            content: '‚úì';
            color: #fff;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .check-text { flex: 1; }
        .check-meta { font-size: 0.75rem; color: var(--text-muted); }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0;
            background: var(--surface-alt);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 1.5rem;
        }

        .tab {
            flex: 1;
            padding: 0.625rem 1rem;
            background: none;
            border: none;
            font: inherit;
            font-size: 0.85rem;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .tab:hover { color: var(--text); }
        .tab.active { background: var(--surface); color: var(--text); font-weight: 500; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }

        /* Meal Cards */
        .meal-card {
            padding: 1.25rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .meal-card:hover { border-color: var(--accent); transform: translateY(-2px); }
        .meal-card.selected { border-color: var(--accent); background: var(--accent-light); }
        .meal-card .meal-name { font-weight: 600; margin-bottom: 0.25rem; }
        .meal-card .meal-meta { font-size: 0.8rem; color: var(--text-muted); }
        .meal-card .meal-cost { font-size: 0.85rem; color: var(--accent); margin-top: 0.5rem; }

        /* Learning Cards */
        .lesson-card {
            display: flex;
            gap: 1rem;
            padding: 1.25rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.15s;
        }

        .lesson-card:hover { border-color: var(--accent); }
        .lesson-card.completed { opacity: 0.6; }

        .lesson-num {
            width: 40px;
            height: 40px;
            background: var(--accent-light);
            color: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .lesson-card.completed .lesson-num {
            background: var(--success);
            color: #fff;
        }

        .lesson-info { flex: 1; }
        .lesson-title { font-weight: 600; margin-bottom: 0.25rem; }
        .lesson-meta { font-size: 0.8rem; color: var(--text-muted); }

        /* Glossary */
        .glossary-item {
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .glossary-term { font-weight: 600; color: var(--accent); margin-bottom: 0.25rem; }
        .glossary-def { font-size: 0.9rem; color: var(--text-muted); }

        /* Scripture */
        .scripture {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 1rem;
            color: var(--text-muted);
            padding: 1.5rem 0;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
            text-align: center;
        }

        .scripture-ref {
            display: block;
            font-style: normal;
            font-size: 0.75rem;
            color: var(--accent);
            margin-top: 0.5rem;
        }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .modal.open { opacity: 1; visibility: visible; }

        .modal-content {
            background: var(--surface);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 1.5rem; }

        /* Spacer */
        .spacer { height: 1.5rem; }
        .spacer-lg { height: 3rem; }

        /* Flex utilities */
        .flex { display: flex; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .gap-sm { gap: 0.5rem; }
        .gap-md { gap: 1rem; }

        /* Mobile nav */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 0.5rem;
            z-index: 100;
        }

        .mobile-nav-inner {
            display: flex;
            justify-content: space-around;
            max-width: 500px;
            margin: 0 auto;
        }

        .mobile-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font: inherit;
            font-size: 0.65rem;
            cursor: pointer;
        }

        .mobile-nav-btn.active { color: var(--accent); }
        .mobile-nav-btn svg { width: 24px; height: 24px; }

        @media (max-width: 600px) {
            .mobile-nav { display: block; }
            .main { padding-bottom: 80px; }
        }

        /* Category colors */
        .cat-food { background: #C19A6B; }
        .cat-gas { background: #2D5A3D; }
        .cat-bills { background: #8B3A3A; }
        .cat-entertainment { background: #2563eb; }
        .cat-shopping { background: #7c3aed; }
        .cat-health { background: #059669; }
        .cat-subscriptions { background: #d97706; }
        .cat-giving { background: #ec4899; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-in { animation: fadeIn 0.3s ease; }

        /* Streak badge */
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--accent-light);
            color: var(--accent);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Sync indicator */
        .sync-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .sync-dot.offline { background: var(--text-muted); }
        .sync-dot.online { background: var(--success); animation: pulse 2s infinite; }
        .sync-dot.syncing { background: var(--accent); animation: pulse 0.5s infinite; }
        .sync-dot.error { background: var(--danger); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
<div class="app">
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-brand">Life Hub</div>
        <div class="nav-links">
            <button class="nav-link active" data-panel="dashboard">Dashboard</button>
            <button class="nav-link" data-panel="spending">Spending</button>
            <button class="nav-link" data-panel="goals">Goals</button>
            <button class="nav-link" data-panel="learning">Learning</button>
            <button class="nav-link" data-panel="meals">Meals</button>
            <button class="nav-link" data-panel="habits">Habits</button>
            <button class="nav-link" data-panel="career">Career</button>
            <button class="nav-link" data-panel="settings">‚öôÔ∏è</button>
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <div class="mobile-nav-inner">
            <button class="mobile-nav-btn active" data-panel="dashboard">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                Home
            </button>
            <button class="mobile-nav-btn" data-panel="spending">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
                Money
            </button>
            <button class="mobile-nav-btn" data-panel="learning">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>
                Learn
            </button>
            <button class="mobile-nav-btn" data-panel="habits">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>
                Habits
            </button>
            <button class="mobile-nav-btn" data-panel="career">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/></svg>
                Career
            </button>
            <button class="mobile-nav-btn" data-panel="settings">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                Settings
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main">
        <!-- DASHBOARD -->
        <div id="dashboard" class="panel active">
            <div class="container">
                <p class="eyebrow" id="date-display"></p>
                <h1 class="headline-xl" id="greeting">Good Morning</h1>

                <div class="spacer-lg"></div>

                <!-- Quick Stats Row -->
                <div class="grid grid-4">
                    <div class="card card-accent">
                        <p class="eyebrow">Daily Budget</p>
                        <div class="stat stat-gold" id="dash-daily">$0</div>
                        <p class="caption"><span id="dash-days">0</span> days until payday</p>
                    </div>
                    <div class="card">
                        <p class="eyebrow">Spent Today</p>
                        <div class="stat stat-danger" id="dash-today">$0</div>
                        <p class="caption">Period total: $<span id="dash-period">0</span></p>
                    </div>
                    <div class="card">
                        <p class="eyebrow">Emergency Fund</p>
                        <div class="stat stat-success" id="dash-ef">$0</div>
                        <div class="progress"><div class="progress-fill success" id="dash-ef-bar"></div></div>
                    </div>
                    <div class="card">
                        <p class="eyebrow">Net Worth Goal</p>
                        <div class="stat" id="dash-nw">$0</div>
                        <p class="caption">Target: $1,000,000</p>
                    </div>
                </div>

                <div class="spacer-lg"></div>

                <!-- Quick Add -->
                <div class="card card-gold">
                    <p class="eyebrow">Quick Add Expense</p>
                    <div class="spacer"></div>
                    <div class="quick-grid" id="quick-add-grid"></div>
                </div>

                <div class="spacer-lg"></div>

                <div class="grid grid-2">
                    <!-- Today's Focus -->
                    <div class="card">
                        <p class="eyebrow">Today's Focus</p>
                        <div class="spacer"></div>
                        <div class="check-list" id="dash-focus"></div>
                    </div>

                    <!-- Spending Breakdown -->
                    <div class="card">
                        <p class="eyebrow">Spending This Period</p>
                        <div class="cat-bar" id="dash-cat-bar"></div>
                        <div class="cat-legend" id="dash-cat-legend"></div>
                    </div>
                </div>

                <div class="scripture">
                    "The plans of the diligent lead surely to abundance."
                    <span class="scripture-ref">‚Äî Proverbs 21:5</span>
                </div>
            </div>
        </div>

        <!-- SPENDING -->
        <div id="spending" class="panel">
            <div class="container">
                <p class="eyebrow">Money</p>
                <h1 class="headline-lg">Track Spending</h1>

                <div class="spacer-lg"></div>

                <div class="grid grid-2">
                    <!-- Left Column -->
                    <div>
                        <!-- Add Expense -->
                        <div class="card card-gold">
                            <p class="eyebrow">Add Expense</p>
                            <div class="spacer"></div>
                            <div class="flex gap-sm" style="margin-bottom:0.75rem">
                                <input type="number" id="exp-amount" placeholder="Amount" style="flex:1">
                                <select id="exp-category" style="flex:1"></select>
                            </div>
                            <input type="text" id="exp-note" placeholder="Note (optional)" style="margin-bottom:0.75rem">
                            <button class="btn btn-primary btn-block" onclick="addExpense()">Add Expense</button>
                        </div>

                        <!-- Quick Add -->
                        <div class="card">
                            <p class="eyebrow">Quick Add</p>
                            <div class="spacer"></div>
                            <div class="quick-grid" id="spend-quick-grid"></div>
                        </div>

                        <!-- Budget Summary -->
                        <div class="card" style="background:var(--text);color:var(--bg)">
                            <div class="flex-between">
                                <div>
                                    <p class="eyebrow" style="color:var(--accent)">Budget</p>
                                    <div class="stat" style="color:var(--bg)" id="spend-budget">$300</div>
                                </div>
                                <div style="text-align:right">
                                    <p class="eyebrow" style="color:var(--accent)">Remaining</p>
                                    <div class="stat" style="color:var(--bg)" id="spend-remaining">$300</div>
                                </div>
                            </div>
                            <div class="progress" style="background:rgba(255,255,255,0.2);margin:1rem 0">
                                <div class="progress-fill gold" id="spend-progress" style="width:100%"></div>
                            </div>
                            <p class="caption" style="color:rgba(255,255,255,0.6);text-align:center">
                                $<span id="spend-daily">0</span>/day for <span id="spend-days">0</span> days
                            </p>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div>
                        <!-- Category Breakdown -->
                        <div class="card">
                            <p class="eyebrow">By Category</p>
                            <div class="cat-bar" id="spend-cat-bar"></div>
                            <div class="cat-legend" id="spend-cat-legend"></div>
                        </div>

                        <!-- Expense Log -->
                        <div class="card">
                            <div class="flex-between" style="margin-bottom:1rem">
                                <p class="eyebrow" style="margin:0">Recent Expenses</p>
                                <button class="btn btn-sm btn-ghost" onclick="clearExpenses()">Clear All</button>
                            </div>
                            <div class="expense-list" id="expense-log"></div>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="card">
                    <p class="eyebrow">Budget Settings</p>
                    <div class="spacer"></div>
                    <div class="grid grid-3">
                        <div>
                            <label>Budget Amount</label>
                            <input type="number" id="set-budget" placeholder="300">
                        </div>
                        <div>
                            <label>Next Payday</label>
                            <input type="date" id="set-payday">
                        </div>
                        <div style="display:flex;align-items:flex-end">
                            <button class="btn btn-primary btn-block" onclick="saveSettings()">Save</button>
                        </div>
                    </div>
                </div>

                <div class="scripture">
                    "Whoever can be trusted with very little can also be trusted with much."
                    <span class="scripture-ref">‚Äî Luke 16:10</span>
                </div>
            </div>
        </div>

        <!-- GOALS -->
        <div id="goals" class="panel">
            <div class="container">
                <p class="eyebrow">Financial Goals</p>
                <h1 class="headline-lg">Your Progress</h1>

                <div class="spacer-lg"></div>

                <div class="grid grid-2">
                    <!-- Emergency Fund -->
                    <div class="card card-success">
                        <p class="eyebrow">Emergency Fund</p>
                        <div class="flex-between" style="margin:1rem 0">
                            <div class="stat stat-lg" id="goal-ef">$0</div>
                            <span class="body-sm">of $<span id="goal-ef-target">1,500</span></span>
                        </div>
                        <div class="progress" style="height:10px"><div class="progress-fill success" id="goal-ef-bar"></div></div>
                        <div class="spacer"></div>
                        <div class="flex gap-sm">
                            <input type="number" id="ef-input" placeholder="Update amount" style="flex:1">
                            <button class="btn btn-primary" onclick="updateEF()">Update</button>
                        </div>
                    </div>

                    <!-- Advance-Free Streak -->
                    <div class="card card-gold">
                        <p class="eyebrow">Advance-Free Streak</p>
                        <div class="flex-between" style="margin:1rem 0">
                            <div class="stat stat-lg" id="goal-streak">0</div>
                            <span class="body-sm">pay periods</span>
                        </div>
                        <div class="progress" style="height:10px"><div class="progress-fill gold" id="goal-streak-bar"></div></div>
                        <div class="spacer"></div>
                        <div class="flex gap-sm">
                            <button class="btn btn-primary" style="flex:1" onclick="addStreak()">+1 Period</button>
                            <button class="btn" onclick="resetStreak()">Reset</button>
                        </div>
                    </div>

                    <!-- Net Worth -->
                    <div class="card">
                        <p class="eyebrow">Net Worth</p>
                        <div class="flex-between" style="margin:1rem 0">
                            <div class="stat stat-lg" id="goal-nw">$0</div>
                            <span class="body-sm">of $1,000,000</span>
                        </div>
                        <div class="progress" style="height:10px"><div class="progress-fill gold" id="goal-nw-bar"></div></div>
                        <div class="spacer"></div>
                        <div class="flex gap-sm">
                            <input type="number" id="nw-input" placeholder="Update amount" style="flex:1">
                            <button class="btn btn-primary" onclick="updateNW()">Update</button>
                        </div>
                    </div>

                    <!-- Debt Payoff -->
                    <div class="card card-danger">
                        <p class="eyebrow">Debt Remaining</p>
                        <div class="flex-between" style="margin:1rem 0">
                            <div class="stat stat-lg" id="goal-debt">$14,000</div>
                            <span class="body-sm">to pay off</span>
                        </div>
                        <div class="progress" style="height:10px"><div class="progress-fill danger" id="goal-debt-bar" style="width:100%"></div></div>
                        <div class="spacer"></div>
                        <div class="flex gap-sm">
                            <input type="number" id="debt-input" placeholder="Update amount" style="flex:1">
                            <button class="btn btn-primary" onclick="updateDebt()">Update</button>
                        </div>
                    </div>

                    <!-- Investment -->
                    <div class="card">
                        <p class="eyebrow">Investment Accounts</p>
                        <div class="flex-between" style="margin:1rem 0">
                            <div class="stat stat-lg" id="goal-invest">$0</div>
                            <span class="body-sm">total invested</span>
                        </div>
                        <div class="spacer"></div>
                        <div class="flex gap-sm">
                            <input type="number" id="invest-input" placeholder="Update amount" style="flex:1">
                            <button class="btn btn-primary" onclick="updateInvest()">Update</button>
                        </div>
                    </div>

                    <!-- Savings -->
                    <div class="card">
                        <p class="eyebrow">General Savings</p>
                        <div class="flex-between" style="margin:1rem 0">
                            <div class="stat stat-lg" id="goal-savings">$0</div>
                            <span class="body-sm">saved</span>
                        </div>
                        <div class="spacer"></div>
                        <div class="flex gap-sm">
                            <input type="number" id="savings-input" placeholder="Update amount" style="flex:1">
                            <button class="btn btn-primary" onclick="updateSavings()">Update</button>
                        </div>
                    </div>
                </div>

                <div class="scripture">
                    "A good man leaves an inheritance to his children's children."
                    <span class="scripture-ref">‚Äî Proverbs 13:22</span>
                </div>
            </div>
        </div>

        <!-- LEARNING -->
        <div id="learning" class="panel">
            <div class="container">
                <p class="eyebrow">Education</p>
                <h1 class="headline-lg">Build Your Knowledge</h1>
                <p class="body-lg" style="color:var(--text-muted);margin-top:0.5rem">15 minutes a day. That's all it takes.</p>

                <div class="spacer-lg"></div>

                <div class="tabs">
                    <button class="tab active" data-tab="curriculum">Curriculum</button>
                    <button class="tab" data-tab="videos">Videos</button>
                    <button class="tab" data-tab="glossary">Glossary</button>
                </div>

                <!-- Curriculum Tab -->
                <div id="tab-curriculum" class="tab-content">
                    <div class="grid grid-2">
                        <div>
                            <p class="eyebrow">Current Module</p>
                            <div class="spacer"></div>
                            <div id="current-module"></div>
                        </div>
                        <div>
                            <p class="eyebrow">Your Progress</p>
                            <div class="spacer"></div>
                            <div class="card">
                                <div class="flex-between">
                                    <span>Lessons Completed</span>
                                    <strong id="lessons-done">0</strong>
                                </div>
                                <div class="progress" style="margin:1rem 0"><div class="progress-fill gold" id="learn-progress"></div></div>
                                <div class="streak-badge">
                                    <span>üî•</span>
                                    <span><span id="learn-streak">0</span> day streak</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="spacer-lg"></div>

                    <p class="eyebrow">All Modules</p>
                    <div class="spacer"></div>
                    <div id="all-modules"></div>
                </div>

                <!-- Videos Tab -->
                <div id="tab-videos" class="tab-content" style="display:none">
                    <div class="card card-gold">
                        <p class="headline-sm">Recommended Channels</p>
                        <p class="body-sm" style="color:var(--text-muted);margin-top:0.5rem">Quality investing education on YouTube (5-25 min videos)</p>
                        <div class="spacer"></div>
                        <div id="video-channels"></div>
                    </div>

                    <div class="spacer-lg"></div>

                    <p class="eyebrow">Watch History</p>
                    <div class="spacer"></div>
                    <div id="watch-history">
                        <p class="caption">Videos you mark as watched will appear here.</p>
                    </div>
                </div>

                <!-- Glossary Tab -->
                <div id="tab-glossary" class="tab-content" style="display:none">
                    <input type="text" id="glossary-search" placeholder="Search terms..." style="margin-bottom:1.5rem">
                    <div id="glossary-list"></div>
                </div>

                <div class="scripture">
                    "An intelligent heart acquires knowledge, and the ear of the wise seeks knowledge."
                    <span class="scripture-ref">‚Äî Proverbs 18:15</span>
                </div>
            </div>
        </div>

        <!-- MEALS -->
        <div id="meals" class="panel">
            <div class="container">
                <p class="eyebrow">Body</p>
                <h1 class="headline-lg">Meal Planning</h1>

                <div class="spacer-lg"></div>

                <div class="tabs">
                    <button class="tab active" data-tab="weekly">Weekly Plan</button>
                    <button class="tab" data-tab="recipes">Recipes</button>
                    <button class="tab" data-tab="restaurants">Eating Out</button>
                </div>

                <!-- Weekly Plan Tab -->
                <div id="tab-weekly" class="tab-content">
                    <div class="card card-gold">
                        <div class="flex-between">
                            <div>
                                <p class="eyebrow">Tonight's Dinner</p>
                                <p class="headline-md" id="tonight-meal">Select a meal</p>
                                <p class="body-sm" style="color:var(--text-muted)" id="tonight-meta"></p>
                            </div>
                            <button class="btn" onclick="randomMeal()">Surprise Me</button>
                        </div>
                    </div>

                    <div class="spacer"></div>

                    <p class="eyebrow">This Week</p>
                    <div class="spacer"></div>
                    <div class="grid grid-4" id="weekly-meals"></div>

                    <div class="spacer-lg"></div>

                    <div class="card">
                        <p class="eyebrow">Grocery Grab List</p>
                        <div class="spacer"></div>
                        <div class="check-list" id="grab-list"></div>
                    </div>
                </div>

                <!-- Recipes Tab -->
                <div id="tab-recipes" class="tab-content" style="display:none">
                    <div class="grid grid-3" id="recipe-grid"></div>
                </div>

                <!-- Restaurants Tab -->
                <div id="tab-restaurants" class="tab-content" style="display:none">
                    <div class="card card-gold">
                        <p class="headline-sm">Quick Pick: Where should I eat?</p>
                        <p class="body-sm" style="color:var(--text-muted);margin-top:0.5rem">Based on your favorites</p>
                        <div class="spacer"></div>
                        <button class="btn btn-primary" onclick="suggestRestaurant()">Suggest a Spot</button>
                        <div id="restaurant-suggestion" style="margin-top:1rem"></div>
                    </div>

                    <div class="spacer-lg"></div>

                    <div class="flex-between">
                        <p class="eyebrow">My Restaurants</p>
                        <button class="btn btn-sm" onclick="openRestaurantModal()">+ Add</button>
                    </div>
                    <div class="spacer"></div>
                    <div id="restaurant-list"></div>
                </div>

                <div class="scripture">
                    "Whether you eat or drink, do it all for the glory of God."
                    <span class="scripture-ref">‚Äî 1 Corinthians 10:31</span>
                </div>
            </div>
        </div>

        <!-- HABITS -->
        <div id="habits" class="panel">
            <div class="container">
                <p class="eyebrow">Daily Rhythms</p>
                <h1 class="headline-lg">Build Your Habits</h1>
                <p class="body-lg" style="color:var(--text-muted);margin-top:0.5rem">Progress, not perfection. If you miss a day, just start again tomorrow.</p>

                <div class="spacer-lg"></div>

                <div class="grid grid-2">
                    <!-- Morning -->
                    <div class="card">
                        <div class="flex-between" style="margin-bottom:1rem">
                            <p class="eyebrow" style="margin:0">Morning Routine</p>
                            <span class="caption">8:30 AM</span>
                        </div>
                        <div class="check-list" id="morning-habits"></div>
                    </div>

                    <!-- Evening -->
                    <div class="card">
                        <div class="flex-between" style="margin-bottom:1rem">
                            <p class="eyebrow" style="margin:0">Evening Wind-Down</p>
                            <span class="caption">11:00 PM</span>
                        </div>
                        <div class="check-list" id="evening-habits"></div>
                    </div>
                </div>

                <div class="spacer-lg"></div>

                <!-- Daily Focus -->
                <div class="card card-gold">
                    <div class="flex-between" style="margin-bottom:1rem">
                        <p class="eyebrow" style="margin:0">Daily Focus</p>
                        <span class="caption">Do what you can</span>
                    </div>
                    <div class="check-list" id="focus-habits"></div>
                </div>

                <div class="spacer-lg"></div>

                <!-- Habit Stats -->
                <div class="card">
                    <p class="eyebrow">This Week</p>
                    <div class="spacer"></div>
                    <div class="grid grid-4" id="week-grid"></div>
                </div>

                <div class="scripture">
                    "Do you not know that your bodies are temples of the Holy Spirit?"
                    <span class="scripture-ref">‚Äî 1 Corinthians 6:19</span>
                </div>
            </div>
        </div>

        <!-- CAREER -->
        <div id="career" class="panel">
            <div class="container">
                <p class="eyebrow">Career Growth</p>
                <h1 class="headline-lg">Art Director ‚Üí $150k+</h1>

                <div class="spacer-lg"></div>

                <div class="grid grid-2">
                    <div class="card card-gold">
                        <p class="eyebrow">Current Salary</p>
                        <div class="stat stat-lg">$75,000</div>
                    </div>
                    <div class="card">
                        <p class="eyebrow">Target Salary</p>
                        <div class="stat stat-lg stat-gold">$150,000</div>
                        <div class="progress" style="margin-top:1rem"><div class="progress-fill gold" style="width:50%"></div></div>
                    </div>
                </div>

                <div class="spacer-lg"></div>

                <div class="tabs">
                    <button class="tab active" data-tab="portfolio">Portfolio</button>
                    <button class="tab" data-tab="linkedin">LinkedIn</button>
                    <button class="tab" data-tab="jobs">Job Search</button>
                    <button class="tab" data-tab="network">Networking</button>
                </div>

                <!-- Portfolio Tab -->
                <div id="tab-portfolio" class="tab-content">
                    <div class="card">
                        <p class="eyebrow">Portfolio Build Checklist</p>
                        <div class="spacer"></div>
                        <div class="check-list" id="portfolio-tasks"></div>
                    </div>
                </div>

                <!-- LinkedIn Tab -->
                <div id="tab-linkedin" class="tab-content" style="display:none">
                    <div class="card card-gold">
                        <p class="headline-sm">Post weekly about AI in advertising</p>
                        <p class="body-sm" style="color:var(--text-muted);margin-top:0.5rem">Be known as "the AI creative person"</p>
                    </div>
                    <div class="spacer"></div>
                    <div class="card">
                        <p class="eyebrow">Weekly Posts</p>
                        <div class="spacer"></div>
                        <div class="check-list" id="linkedin-tasks"></div>
                    </div>
                </div>

                <!-- Jobs Tab -->
                <div id="tab-jobs" class="tab-content" style="display:none">
                    <div class="flex-between" style="margin-bottom:1rem">
                        <p class="eyebrow" style="margin:0">Applications</p>
                        <button class="btn btn-sm btn-primary" onclick="openJobModal()">+ Add Application</button>
                    </div>
                    <div id="job-list"></div>
                </div>

                <!-- Network Tab -->
                <div id="tab-network" class="tab-content" style="display:none">
                    <div class="flex-between" style="margin-bottom:1rem">
                        <p class="eyebrow" style="margin:0">Connections</p>
                        <button class="btn btn-sm btn-primary" onclick="openNetworkModal()">+ Add Contact</button>
                    </div>
                    <div id="network-list"></div>
                </div>

                <div class="scripture">
                    "Whatever you do, work at it with all your heart."
                    <span class="scripture-ref">‚Äî Colossians 3:23</span>
                </div>
            </div>
        </div>

        <!-- SETTINGS -->
        <div id="settings" class="panel">
            <div class="container">
                <p class="eyebrow">Data & Settings</p>
                <h1 class="headline-lg">Manage Your Data</h1>

                <div class="spacer-lg"></div>

                <!-- Sync Status -->
                <div class="card" id="sync-status-card">
                    <div class="flex-between">
                        <div>
                            <p class="eyebrow">Cloud Sync</p>
                            <p class="headline-sm" id="sync-status">Not Connected</p>
                        </div>
                        <div id="sync-indicator" class="sync-dot offline"></div>
                    </div>
                    <p class="caption" style="margin-top:0.5rem" id="sync-detail">Your data is only stored locally on this device.</p>
                </div>

                <div class="spacer-lg"></div>

                <!-- Firebase Setup -->
                <div class="card card-gold">
                    <p class="eyebrow">Cloud Database Setup</p>
                    <p class="headline-sm" style="margin:1rem 0">Connect to Firebase (Free)</p>
                    <p class="body-sm" style="color:var(--text-muted)">Firebase provides free cloud storage so your data syncs across devices and survives any updates.</p>

                    <div class="spacer"></div>

                    <div id="firebase-setup">
                        <p class="body-sm" style="margin-bottom:1rem"><strong>One-time setup (5 minutes):</strong></p>
                        <ol style="font-size:0.9rem;color:var(--text-muted);padding-left:1.25rem;line-height:1.8">
                            <li>Go to <a href="https://console.firebase.google.com" target="_blank" style="color:var(--accent)">console.firebase.google.com</a></li>
                            <li>Create a new project (name it anything)</li>
                            <li>Go to Build ‚Üí Realtime Database ‚Üí Create Database</li>
                            <li>Choose "Start in test mode" ‚Üí Enable</li>
                            <li>Go to Project Settings ‚Üí Your apps ‚Üí Web app</li>
                            <li>Register app, copy your config</li>
                            <li>Paste your Firebase config below:</li>
                        </ol>

                        <div class="spacer"></div>

                        <textarea id="firebase-config" placeholder='{
  "apiKey": "your-api-key",
  "authDomain": "your-project.firebaseapp.com",
  "databaseURL": "https://your-project-default-rtdb.firebaseio.com",
  "projectId": "your-project-id"
}' style="min-height:140px;font-family:monospace;font-size:0.8rem"></textarea>

                        <div class="spacer"></div>

                        <div class="flex gap-sm">
                            <button class="btn btn-primary" onclick="connectFirebase()">Connect to Firebase</button>
                            <button class="btn" onclick="disconnectFirebase()">Disconnect</button>
                        </div>
                    </div>

                    <div id="firebase-connected" style="display:none">
                        <div class="card card-success" style="margin:0">
                            <p class="body-sm"><strong>Connected!</strong> Your data syncs automatically.</p>
                            <p class="caption" style="margin-top:0.5rem">Last sync: <span id="last-sync">Never</span></p>
                        </div>
                    </div>
                </div>

                <div class="spacer-lg"></div>

                <!-- Local Backup -->
                <div class="card">
                    <p class="eyebrow">Local Backup</p>
                    <p class="headline-sm" style="margin:1rem 0">Export & Import Data</p>
                    <p class="body-sm" style="color:var(--text-muted)">Download a backup file or restore from a previous backup. Always keep a backup before major changes!</p>

                    <div class="spacer"></div>

                    <div class="grid grid-2">
                        <div class="card" style="text-align:center">
                            <p class="body-lg" style="margin-bottom:1rem">Export Backup</p>
                            <button class="btn btn-primary btn-block" onclick="exportData()">
                                <span>‚Üì</span> Download JSON
                            </button>
                            <p class="caption" style="margin-top:0.75rem">Save your data to a file</p>
                        </div>

                        <div class="card" style="text-align:center">
                            <p class="body-lg" style="margin-bottom:1rem">Import Backup</p>
                            <label class="btn btn-block" style="cursor:pointer">
                                <span>‚Üë</span> Upload JSON
                                <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
                            </label>
                            <p class="caption" style="margin-top:0.75rem">Restore from a backup file</p>
                        </div>
                    </div>
                </div>

                <div class="spacer-lg"></div>

                <!-- Data Stats -->
                <div class="card">
                    <p class="eyebrow">Data Overview</p>
                    <div class="spacer"></div>
                    <div class="grid grid-4">
                        <div style="text-align:center">
                            <div class="stat stat-sm" id="stat-expenses">0</div>
                            <p class="caption">Expenses</p>
                        </div>
                        <div style="text-align:center">
                            <div class="stat stat-sm" id="stat-habits">0</div>
                            <p class="caption">Habit Days</p>
                        </div>
                        <div style="text-align:center">
                            <div class="stat stat-sm" id="stat-lessons">0</div>
                            <p class="caption">Lessons Done</p>
                        </div>
                        <div style="text-align:center">
                            <div class="stat stat-sm" id="stat-size">0 KB</div>
                            <p class="caption">Data Size</p>
                        </div>
                    </div>
                </div>

                <div class="spacer-lg"></div>

                <!-- Danger Zone -->
                <div class="card card-danger">
                    <p class="eyebrow">Danger Zone</p>
                    <div class="spacer"></div>
                    <div class="flex-between">
                        <div>
                            <p class="body-lg">Reset All Data</p>
                            <p class="caption">This permanently deletes everything. Export a backup first!</p>
                        </div>
                        <button class="btn btn-danger" onclick="resetAllData()">Reset</button>
                    </div>
                </div>

                <div class="scripture">
                    "For where your treasure is, there your heart will be also."
                    <span class="scripture-ref">‚Äî Matthew 6:21</span>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Modals -->
<div id="expense-modal" class="modal">
    <div class="modal-content">
        <p class="modal-title">Add Expense</p>
        <input type="number" id="modal-amount" placeholder="Amount" style="margin-bottom:0.75rem">
        <select id="modal-category" style="margin-bottom:0.75rem"></select>
        <input type="text" id="modal-note" placeholder="Note (optional)" style="margin-bottom:1rem">
        <div class="flex gap-sm">
            <button class="btn" style="flex:1" onclick="closeModal('expense-modal')">Cancel</button>
            <button class="btn btn-primary" style="flex:1" onclick="addExpenseFromModal()">Add</button>
        </div>
    </div>
</div>

<div id="restaurant-modal" class="modal">
    <div class="modal-content">
        <p class="modal-title">Add Restaurant</p>
        <input type="text" id="rest-name" placeholder="Restaurant name" style="margin-bottom:0.75rem">
        <input type="text" id="rest-cuisine" placeholder="Cuisine type" style="margin-bottom:0.75rem">
        <textarea id="rest-favorites" placeholder="Your go-to orders..." style="margin-bottom:1rem"></textarea>
        <div class="flex gap-sm">
            <button class="btn" style="flex:1" onclick="closeModal('restaurant-modal')">Cancel</button>
            <button class="btn btn-primary" style="flex:1" onclick="addRestaurant()">Add</button>
        </div>
    </div>
</div>

<div id="job-modal" class="modal">
    <div class="modal-content">
        <p class="modal-title">Add Job Application</p>
        <input type="text" id="job-company" placeholder="Company" style="margin-bottom:0.75rem">
        <input type="text" id="job-title" placeholder="Position" style="margin-bottom:0.75rem">
        <select id="job-status" style="margin-bottom:0.75rem">
            <option value="applied">Applied</option>
            <option value="interview">Interview</option>
            <option value="offer">Offer</option>
            <option value="rejected">Rejected</option>
        </select>
        <input type="text" id="job-salary" placeholder="Salary range" style="margin-bottom:1rem">
        <div class="flex gap-sm">
            <button class="btn" style="flex:1" onclick="closeModal('job-modal')">Cancel</button>
            <button class="btn btn-primary" style="flex:1" onclick="addJob()">Add</button>
        </div>
    </div>
</div>

<script>
// ===== DATA =====
const STORAGE_KEY = 'life_hub_v3';

const CATEGORIES = {
    food: { label: 'Food & Dining', color: '#C19A6B' },
    gas: { label: 'Gas & Transport', color: '#2D5A3D' },
    bills: { label: 'Bills & Utilities', color: '#8B3A3A' },
    entertainment: { label: 'Entertainment', color: '#2563eb' },
    shopping: { label: 'Shopping', color: '#7c3aed' },
    health: { label: 'Health', color: '#059669' },
    subscriptions: { label: 'Subscriptions', color: '#d97706' },
    giving: { label: 'Giving & Tithes', color: '#ec4899' }
};

const QUICK_AMOUNTS = [
    { amt: 5, cat: 'food' },
    { amt: 10, cat: 'food' },
    { amt: 20, cat: 'food' },
    { amt: 25, cat: 'gas' },
    { amt: 50, cat: 'gas' },
    { amt: 10, cat: 'entertainment' },
    { amt: 20, cat: 'shopping' },
    { amt: 0, cat: 'custom' }
];

const MORNING_HABITS = ['No snooze - feet on floor', 'Gratitude moment', 'Morning mobility (5 min)', 'Glass of water', 'Check Life Hub'];
const EVENING_HABITS = ['Clear bed completely', 'Phone away from bed', 'Dim lights', 'Gentle stretching', 'In bed by 12am'];
const FOCUS_HABITS = ['Log all spending', '15 min learning', '1 hour on business'];

const PORTFOLIO_TASKS = [
    'List all Melt projects (4 years)',
    'Select 6-8 strongest projects',
    'Collect assets for each',
    'Write case study drafts',
    'Build portfolio site',
    'Update LinkedIn profile',
    'Start applying to companies'
];

const LINKEDIN_TASKS = ['Week 1 post', 'Week 2 post', 'Week 3 post', 'Week 4 post'];

const MEALS = [
    { name: 'One-Pan Salmon', meta: '30 min ‚Ä¢ Soft', cost: '$12', items: ['Salmon fillet', 'Broccolini', 'Sweet potato'] },
    { name: 'Shrimp & Grits', meta: '25 min ‚Ä¢ Southern', cost: '$10', items: ['Shrimp (1/2 lb)', 'Grits', 'Butter'] },
    { name: 'Cajun Beef Bowl', meta: '25 min ‚Ä¢ Filling', cost: '$8', items: ['Ground beef', 'Bell pepper', 'Rice'] },
    { name: 'Chicken Soup', meta: '25 min ‚Ä¢ Comfort', cost: '$7', items: ['Rotisserie chicken', 'Carrots', 'Celery'] },
    { name: 'Eggs & Grits', meta: '10 min ‚Ä¢ Quick', cost: '$3', items: ['Eggs', 'Grits', 'Hot sauce'] },
    { name: 'Steak Night', meta: '35 min ‚Ä¢ Treat', cost: '$18', items: ['Ribeye steak', 'Potatoes', 'Butter'] },
    { name: 'Tilapia & Asparagus', meta: '20 min ‚Ä¢ Light', cost: '$9', items: ['Tilapia fillet', 'Asparagus', 'Lemon'] },
    { name: 'Smothered Chicken', meta: '30 min ‚Ä¢ Rich', cost: '$8', items: ['Chicken thighs', 'Onion', 'Rice'] }
];

const CURRICULUM = [
    { module: 'Stock Market Basics', lessons: ['What is a stock?', 'How the market works', 'Reading stock quotes', 'Market orders vs limit orders', 'Building a watchlist'] },
    { module: 'Fundamental Analysis', lessons: ['Understanding financial statements', 'P/E ratio explained', 'Evaluating company health', 'Finding undervalued stocks'] },
    { module: 'Technical Analysis', lessons: ['Reading charts', 'Support and resistance', 'Moving averages', 'Volume analysis'] },
    { module: 'Options Basics', lessons: ['What are options?', 'Calls vs puts', 'Strike price and expiration', 'Basic options strategies'] },
    { module: 'Retirement Planning', lessons: ['401k basics', 'IRA types explained', 'Target date funds', 'Compound interest power'] },
    { module: 'Crypto Fundamentals', lessons: ['What is blockchain?', 'Bitcoin basics', 'Ethereum and smart contracts', 'Crypto risks'] },
    { module: 'Real Estate Investing', lessons: ['REITs explained', 'Rental property basics', 'Real estate crowdfunding', 'Tax advantages'] }
];

const GLOSSARY = [
    { term: 'Stock', def: 'A share of ownership in a company. When you buy stock, you own a small piece of that business.' },
    { term: 'Dividend', def: 'A portion of company profits paid to shareholders, usually quarterly.' },
    { term: 'P/E Ratio', def: 'Price-to-Earnings ratio. Stock price divided by earnings per share. Helps determine if a stock is over or undervalued.' },
    { term: 'ETF', def: 'Exchange-Traded Fund. A basket of stocks or bonds that trades like a single stock.' },
    { term: 'Bull Market', def: 'A market condition where prices are rising or expected to rise.' },
    { term: 'Bear Market', def: 'A market condition where prices are falling or expected to fall, typically 20%+ decline.' },
    { term: 'Call Option', def: 'A contract giving you the right to BUY a stock at a specific price before expiration.' },
    { term: 'Put Option', def: 'A contract giving you the right to SELL a stock at a specific price before expiration.' },
    { term: 'Strike Price', def: 'The price at which an option can be exercised.' },
    { term: 'Compound Interest', def: 'Interest earned on both your initial investment AND accumulated interest. The key to wealth building.' },
    { term: 'Dollar Cost Averaging', def: 'Investing a fixed amount regularly regardless of price, reducing impact of volatility.' },
    { term: 'Market Cap', def: 'Total market value of a company (share price √ó total shares). Large cap = $10B+, Mid cap = $2-10B, Small cap = under $2B.' },
    { term: 'REIT', def: 'Real Estate Investment Trust. A company that owns income-producing real estate. Required to pay 90% of income as dividends.' }
];

const VIDEO_CHANNELS = [
    { name: 'Plain Bagel', focus: 'Stock basics, investing fundamentals', style: 'Clear explanations, 10-15 min' },
    { name: 'Andrei Jikh', focus: 'Personal finance, passive income', style: 'Engaging, 12-20 min' },
    { name: 'InTheMoney', focus: 'Options trading', style: 'Educational, 15-25 min' },
    { name: 'Graham Stephan', focus: 'Real estate, saving money', style: 'Practical tips, 10-15 min' },
    { name: 'Coin Bureau', focus: 'Cryptocurrency', style: 'In-depth analysis, 15-25 min' },
    { name: 'Two Cents (PBS)', focus: 'Financial literacy basics', style: 'Animated, 5-8 min' }
];

let data = {
    budget: 300,
    payday: '',
    expenses: [],
    emergencyFund: 0,
    emergencyTarget: 1500,
    advanceFreeStreak: 0,
    netWorth: 0,
    debt: 14000,
    investment: 0,
    savings: 0,
    todayMeal: 0,
    weeklyMeals: [0, 1, 2, 3, 4, 5, 6],
    habits: {},
    portfolioTasks: {},
    linkedinTasks: {},
    lessonsCompleted: {},
    learnStreak: 0,
    restaurants: [],
    jobs: [],
    network: []
};

// ===== INIT =====
function init() {
    loadData();
    setupNav();
    setupTabs();
    populateCategories();
    populateQuickAdd();
    updateGreeting();
    updateDashboard();
    updateSpending();
    updateGoals();
    updateLearning();
    updateMeals();
    updateHabits();
    updateCareer();
}

function loadData() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) data = { ...data, ...JSON.parse(saved) };
    if (!data.payday) {
        const d = new Date();
        const next = new Date(d.getFullYear(), d.getMonth(), d.getDate() <= 13 ? 13 : 29);
        if (next <= d) next.setMonth(next.getMonth() + 1);
        data.payday = next.toISOString().split('T')[0];
    }
}

function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

// ===== NAVIGATION =====
function setupNav() {
    document.querySelectorAll('[data-panel]').forEach(btn => {
        btn.addEventListener('click', () => {
            const panel = btn.dataset.panel;
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('[data-panel]').forEach(b => b.classList.remove('active'));
            document.getElementById(panel).classList.add('active');
            document.querySelectorAll(`[data-panel="${panel}"]`).forEach(b => b.classList.add('active'));
        });
    });
}

function setupTabs() {
    document.querySelectorAll('.tabs').forEach(tabs => {
        tabs.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const parent = tab.closest('.panel') || document;
                parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                parent.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                tab.classList.add('active');
                const content = parent.querySelector(`#tab-${tab.dataset.tab}`);
                if (content) content.style.display = 'block';
            });
        });
    });
}

// ===== GREETING =====
function updateGreeting() {
    const h = new Date().getHours();
    const greet = h < 12 ? 'Good Morning' : h < 17 ? 'Good Afternoon' : 'Good Evening';
    const dateStr = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
    document.getElementById('greeting').textContent = greet;
    document.getElementById('date-display').textContent = dateStr;
}

// ===== CATEGORIES =====
function populateCategories() {
    const html = Object.entries(CATEGORIES).map(([k, v]) => `<option value="${k}">${v.label}</option>`).join('');
    document.getElementById('exp-category').innerHTML = html;
    document.getElementById('modal-category').innerHTML = html;
}

function populateQuickAdd() {
    const html = QUICK_AMOUNTS.map(q => {
        if (q.cat === 'custom') {
            return `<button class="quick-btn" onclick="openModal('expense-modal')"><span class="amount">+</span><span class="cat">Custom</span></button>`;
        }
        return `<button class="quick-btn" onclick="quickExpense(${q.amt},'${q.cat}')"><span class="amount">$${q.amt}</span><span class="cat">${q.cat}</span></button>`;
    }).join('');
    document.getElementById('quick-add-grid').innerHTML = html;
    document.getElementById('spend-quick-grid').innerHTML = html;
}

// ===== EXPENSES =====
function addExpense() {
    const amt = parseFloat(document.getElementById('exp-amount').value);
    const cat = document.getElementById('exp-category').value;
    const note = document.getElementById('exp-note').value;
    if (!amt || amt <= 0) return alert('Enter valid amount');
    data.expenses.push({ id: Date.now(), amount: amt, category: cat, note, date: new Date().toISOString() });
    saveData();
    document.getElementById('exp-amount').value = '';
    document.getElementById('exp-note').value = '';
    updateDashboard();
    updateSpending();
}

function quickExpense(amt, cat) {
    data.expenses.push({ id: Date.now(), amount: amt, category: cat, note: '', date: new Date().toISOString() });
    saveData();
    updateDashboard();
    updateSpending();
}

function addExpenseFromModal() {
    const amt = parseFloat(document.getElementById('modal-amount').value);
    const cat = document.getElementById('modal-category').value;
    const note = document.getElementById('modal-note').value;
    if (!amt || amt <= 0) return alert('Enter valid amount');
    data.expenses.push({ id: Date.now(), amount: amt, category: cat, note, date: new Date().toISOString() });
    saveData();
    closeModal('expense-modal');
    updateDashboard();
    updateSpending();
}

function deleteExpense(id) {
    data.expenses = data.expenses.filter(e => e.id !== id);
    saveData();
    updateDashboard();
    updateSpending();
}

function clearExpenses() {
    if (confirm('Clear all expenses?')) {
        data.expenses = [];
        saveData();
        updateDashboard();
        updateSpending();
    }
}

// ===== BUDGET CALC =====
function getPeriodExpenses() {
    const last = getLastPayday();
    return data.expenses.filter(e => new Date(e.date) >= last);
}

function getLastPayday() {
    const pd = new Date(data.payday);
    const today = new Date();
    if (pd > today) pd.setMonth(pd.getMonth() - 1);
    return pd;
}

function getDaysUntil() {
    const today = new Date(); today.setHours(0,0,0,0);
    const pd = new Date(data.payday); pd.setHours(0,0,0,0);
    return Math.max(0, Math.ceil((pd - today) / 86400000));
}

function getTotalSpent() {
    return getPeriodExpenses().reduce((s, e) => s + e.amount, 0);
}

function getTodaySpent() {
    const today = new Date().toDateString();
    return data.expenses.filter(e => new Date(e.date).toDateString() === today).reduce((s, e) => s + e.amount, 0);
}

function getByCategory() {
    const breakdown = {};
    getPeriodExpenses().forEach(e => { breakdown[e.category] = (breakdown[e.category] || 0) + e.amount; });
    return breakdown;
}

// ===== DASHBOARD =====
function updateDashboard() {
    const spent = getTotalSpent();
    const remaining = data.budget - spent;
    const days = getDaysUntil();
    const daily = days > 0 ? Math.floor(remaining / days) : remaining;

    document.getElementById('dash-daily').textContent = '$' + Math.max(0, daily);
    document.getElementById('dash-days').textContent = days;
    document.getElementById('dash-today').textContent = '$' + getTodaySpent().toFixed(0);
    document.getElementById('dash-period').textContent = spent.toFixed(0);
    document.getElementById('dash-ef').textContent = '$' + data.emergencyFund.toLocaleString();
    document.getElementById('dash-ef-bar').style.width = Math.min(100, (data.emergencyFund / data.emergencyTarget) * 100) + '%';
    document.getElementById('dash-nw').textContent = '$' + data.netWorth.toLocaleString();

    renderCatBar('dash-cat-bar', 'dash-cat-legend');

    // Focus habits
    const today = getTodayKey();
    if (!data.habits[today]) data.habits[today] = {};
    document.getElementById('dash-focus').innerHTML = FOCUS_HABITS.map((h, i) => {
        const done = data.habits[today][`focus_${i}`];
        return `<div class="check-item ${done ? 'done' : ''}" onclick="toggleHabit('focus',${i})"><div class="check-box"></div><span class="check-text">${h}</span></div>`;
    }).join('');
}

// ===== SPENDING =====
function updateSpending() {
    const spent = getTotalSpent();
    const remaining = data.budget - spent;
    const days = getDaysUntil();
    const daily = days > 0 ? Math.floor(remaining / days) : remaining;
    const pct = Math.max(0, (remaining / data.budget) * 100);

    document.getElementById('spend-budget').textContent = '$' + data.budget;
    document.getElementById('spend-remaining').textContent = '$' + Math.max(0, remaining).toFixed(0);
    document.getElementById('spend-daily').textContent = Math.max(0, daily);
    document.getElementById('spend-days').textContent = days;
    document.getElementById('spend-progress').style.width = pct + '%';
    document.getElementById('set-budget').value = data.budget;
    document.getElementById('set-payday').value = data.payday;

    renderCatBar('spend-cat-bar', 'spend-cat-legend');

    // Expense log
    const exps = [...getPeriodExpenses()].reverse().slice(0, 20);
    document.getElementById('expense-log').innerHTML = exps.length ? exps.map(e => {
        const d = new Date(e.date);
        return `<div class="expense-item">
            <div class="expense-cat-dot cat-${e.category}"></div>
            <div class="expense-info">
                <div>${CATEGORIES[e.category]?.label || e.category}${e.note ? ` - ${e.note}` : ''}</div>
                <div class="caption">${d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} at ${d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</div>
            </div>
            <div class="expense-amount">-$${e.amount.toFixed(2)}</div>
            <button class="btn btn-sm btn-ghost expense-delete" onclick="deleteExpense(${e.id})">√ó</button>
        </div>`;
    }).join('') : '<p class="caption" style="text-align:center;padding:2rem">No expenses yet</p>';
}

function renderCatBar(barId, legendId) {
    const breakdown = getByCategory();
    const total = Object.values(breakdown).reduce((a, b) => a + b, 0) || 1;
    document.getElementById(barId).innerHTML = Object.entries(breakdown).map(([cat, amt]) =>
        `<div class="cat-bar-seg cat-${cat}" style="width:${(amt/total)*100}%"></div>`
    ).join('') || '<div style="flex:1;background:var(--border);border-radius:4px"></div>';
    document.getElementById(legendId).innerHTML = Object.entries(breakdown).map(([cat, amt]) =>
        `<div class="cat-legend-item"><div class="expense-cat-dot cat-${cat}"></div><span>${CATEGORIES[cat]?.label || cat}: $${amt.toFixed(0)}</span></div>`
    ).join('') || '<span class="caption">No spending yet</span>';
}

function saveSettings() {
    const b = parseFloat(document.getElementById('set-budget').value);
    const p = document.getElementById('set-payday').value;
    if (b > 0) data.budget = b;
    if (p) data.payday = p;
    saveData();
    updateDashboard();
    updateSpending();
    alert('Settings saved!');
}

// ===== GOALS =====
function updateGoals() {
    document.getElementById('goal-ef').textContent = '$' + data.emergencyFund.toLocaleString();
    document.getElementById('goal-ef-target').textContent = data.emergencyTarget.toLocaleString();
    document.getElementById('goal-ef-bar').style.width = Math.min(100, (data.emergencyFund / data.emergencyTarget) * 100) + '%';
    document.getElementById('goal-streak').textContent = data.advanceFreeStreak;
    document.getElementById('goal-streak-bar').style.width = Math.min(100, (data.advanceFreeStreak / 10) * 100) + '%';
    document.getElementById('goal-nw').textContent = '$' + data.netWorth.toLocaleString();
    document.getElementById('goal-nw-bar').style.width = Math.min(100, (data.netWorth / 1000000) * 100) + '%';
    document.getElementById('goal-debt').textContent = '$' + data.debt.toLocaleString();
    document.getElementById('goal-invest').textContent = '$' + data.investment.toLocaleString();
    document.getElementById('goal-savings').textContent = '$' + data.savings.toLocaleString();
}

function updateEF() { const v = parseFloat(document.getElementById('ef-input').value); if (!isNaN(v)) { data.emergencyFund = v; saveData(); document.getElementById('ef-input').value = ''; updateDashboard(); updateGoals(); } }
function addStreak() { data.advanceFreeStreak++; saveData(); updateGoals(); }
function resetStreak() { if (confirm('Reset streak?')) { data.advanceFreeStreak = 0; saveData(); updateGoals(); } }
function updateNW() { const v = parseFloat(document.getElementById('nw-input').value); if (!isNaN(v)) { data.netWorth = v; saveData(); document.getElementById('nw-input').value = ''; updateDashboard(); updateGoals(); } }
function updateDebt() { const v = parseFloat(document.getElementById('debt-input').value); if (!isNaN(v)) { data.debt = v; saveData(); document.getElementById('debt-input').value = ''; updateGoals(); } }
function updateInvest() { const v = parseFloat(document.getElementById('invest-input').value); if (!isNaN(v)) { data.investment = v; saveData(); document.getElementById('invest-input').value = ''; updateGoals(); } }
function updateSavings() { const v = parseFloat(document.getElementById('savings-input').value); if (!isNaN(v)) { data.savings = v; saveData(); document.getElementById('savings-input').value = ''; updateGoals(); } }

// ===== LEARNING =====
function updateLearning() {
    // Current module
    let currentIdx = 0;
    for (let i = 0; i < CURRICULUM.length; i++) {
        const done = CURRICULUM[i].lessons.every((_, j) => data.lessonsCompleted[`${i}_${j}`]);
        if (!done) { currentIdx = i; break; }
    }
    const current = CURRICULUM[currentIdx];
    document.getElementById('current-module').innerHTML = `
        <div class="card card-accent">
            <p class="headline-sm">${current.module}</p>
            <div class="spacer"></div>
            ${current.lessons.map((l, j) => {
                const done = data.lessonsCompleted[`${currentIdx}_${j}`];
                return `<div class="lesson-card ${done ? 'completed' : ''}" onclick="toggleLesson(${currentIdx},${j})">
                    <div class="lesson-num">${done ? '‚úì' : j+1}</div>
                    <div class="lesson-info"><div class="lesson-title">${l}</div><div class="lesson-meta">~5-10 min</div></div>
                </div>`;
            }).join('')}
        </div>
    `;

    // Stats
    const total = CURRICULUM.reduce((s, m) => s + m.lessons.length, 0);
    const done = Object.keys(data.lessonsCompleted).filter(k => data.lessonsCompleted[k]).length;
    document.getElementById('lessons-done').textContent = `${done}/${total}`;
    document.getElementById('learn-progress').style.width = (done/total*100) + '%';
    document.getElementById('learn-streak').textContent = data.learnStreak;

    // All modules
    document.getElementById('all-modules').innerHTML = CURRICULUM.map((m, i) => {
        const completed = m.lessons.filter((_, j) => data.lessonsCompleted[`${i}_${j}`]).length;
        return `<div class="card" style="margin-bottom:1rem">
            <div class="flex-between"><span class="body-lg">${m.module}</span><span class="caption">${completed}/${m.lessons.length}</span></div>
            <div class="progress"><div class="progress-fill gold" style="width:${completed/m.lessons.length*100}%"></div></div>
        </div>`;
    }).join('');

    // Video channels
    document.getElementById('video-channels').innerHTML = VIDEO_CHANNELS.map(c => `
        <div class="card" style="margin-bottom:0.75rem">
            <div class="flex-between"><strong>${c.name}</strong><span class="caption">${c.style}</span></div>
            <p class="caption">${c.focus}</p>
        </div>
    `).join('');

    // Glossary
    document.getElementById('glossary-list').innerHTML = GLOSSARY.map(g => `
        <div class="glossary-item"><div class="glossary-term">${g.term}</div><div class="glossary-def">${g.def}</div></div>
    `).join('');

    document.getElementById('glossary-search').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        document.getElementById('glossary-list').innerHTML = GLOSSARY.filter(g =>
            g.term.toLowerCase().includes(q) || g.def.toLowerCase().includes(q)
        ).map(g => `<div class="glossary-item"><div class="glossary-term">${g.term}</div><div class="glossary-def">${g.def}</div></div>`).join('');
    });
}

function toggleLesson(mod, lesson) {
    const key = `${mod}_${lesson}`;
    data.lessonsCompleted[key] = !data.lessonsCompleted[key];
    saveData();
    updateLearning();
}

// ===== MEALS =====
function updateMeals() {
    const meal = MEALS[data.todayMeal];
    document.getElementById('tonight-meal').textContent = meal.name;
    document.getElementById('tonight-meta').textContent = `${meal.meta} ‚Ä¢ Est. ${meal.cost}`;

    // Weekly
    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const today = new Date().getDay();
    document.getElementById('weekly-meals').innerHTML = data.weeklyMeals.map((m, i) => {
        const meal = MEALS[m];
        const isToday = i === today;
        return `<div class="meal-card ${isToday ? 'selected' : ''}" onclick="selectDay(${i})">
            <div class="caption">${days[i]}${isToday ? ' (Today)' : ''}</div>
            <div class="meal-name">${meal.name}</div>
            <div class="meal-meta">${meal.meta}</div>
            <div class="meal-cost">${meal.cost}</div>
        </div>`;
    }).join('');

    // Grab list
    const todayKey = getTodayKey();
    if (!data.habits[todayKey]) data.habits[todayKey] = {};
    document.getElementById('grab-list').innerHTML = meal.items.map((item, i) => {
        const done = data.habits[todayKey][`grab_${i}`];
        return `<div class="check-item ${done ? 'done' : ''}" onclick="toggleGrab(${i})"><div class="check-box"></div><span class="check-text">${item}</span></div>`;
    }).join('');

    // Recipes
    document.getElementById('recipe-grid').innerHTML = MEALS.map((m, i) => `
        <div class="meal-card" onclick="setMeal(${i})">
            <div class="meal-name">${m.name}</div>
            <div class="meal-meta">${m.meta}</div>
            <div class="meal-cost">${m.cost}</div>
        </div>
    `).join('');

    // Restaurants
    document.getElementById('restaurant-list').innerHTML = data.restaurants.length ? data.restaurants.map((r, i) => `
        <div class="card" style="margin-bottom:0.75rem">
            <div class="flex-between"><strong>${r.name}</strong><span class="caption">${r.cuisine}</span></div>
            <p class="body-sm" style="color:var(--text-muted);margin-top:0.5rem">${r.favorites}</p>
            <button class="btn btn-sm btn-ghost" style="margin-top:0.5rem" onclick="deleteRestaurant(${i})">Remove</button>
        </div>
    `).join('') : '<p class="caption">No restaurants added yet. Add your favorites!</p>';
}

function setMeal(i) { data.todayMeal = i; saveData(); updateMeals(); }
function randomMeal() { data.todayMeal = Math.floor(Math.random() * MEALS.length); saveData(); updateMeals(); }
function selectDay(d) { data.weeklyMeals[d] = (data.weeklyMeals[d] + 1) % MEALS.length; saveData(); updateMeals(); }
function toggleGrab(i) { const k = getTodayKey(); if (!data.habits[k]) data.habits[k] = {}; data.habits[k][`grab_${i}`] = !data.habits[k][`grab_${i}`]; saveData(); updateMeals(); }

function suggestRestaurant() {
    if (data.restaurants.length === 0) {
        document.getElementById('restaurant-suggestion').innerHTML = '<p class="body-sm">Add some restaurants first!</p>';
        return;
    }
    const r = data.restaurants[Math.floor(Math.random() * data.restaurants.length)];
    document.getElementById('restaurant-suggestion').innerHTML = `
        <div class="card card-accent" style="margin:0">
            <p class="headline-sm">${r.name}</p>
            <p class="caption">${r.cuisine}</p>
            <p class="body-sm" style="margin-top:0.5rem">${r.favorites}</p>
        </div>
    `;
}

function addRestaurant() {
    const name = document.getElementById('rest-name').value.trim();
    const cuisine = document.getElementById('rest-cuisine').value.trim();
    const favorites = document.getElementById('rest-favorites').value.trim();
    if (!name) return alert('Enter restaurant name');
    data.restaurants.push({ name, cuisine, favorites });
    saveData();
    closeModal('restaurant-modal');
    updateMeals();
}

function deleteRestaurant(i) {
    data.restaurants.splice(i, 1);
    saveData();
    updateMeals();
}

// ===== HABITS =====
function getTodayKey() { return new Date().toISOString().split('T')[0]; }

function updateHabits() {
    const today = getTodayKey();
    if (!data.habits[today]) data.habits[today] = {};

    document.getElementById('morning-habits').innerHTML = MORNING_HABITS.map((h, i) => {
        const done = data.habits[today][`morning_${i}`];
        return `<div class="check-item ${done ? 'done' : ''}" onclick="toggleHabit('morning',${i})"><div class="check-box"></div><span class="check-text">${h}</span></div>`;
    }).join('');

    document.getElementById('evening-habits').innerHTML = EVENING_HABITS.map((h, i) => {
        const done = data.habits[today][`evening_${i}`];
        return `<div class="check-item ${done ? 'done' : ''}" onclick="toggleHabit('evening',${i})"><div class="check-box"></div><span class="check-text">${h}</span></div>`;
    }).join('');

    document.getElementById('focus-habits').innerHTML = FOCUS_HABITS.map((h, i) => {
        const done = data.habits[today][`focus_${i}`];
        return `<div class="check-item ${done ? 'done' : ''}" onclick="toggleHabit('focus',${i})"><div class="check-box"></div><span class="check-text">${h}</span></div>`;
    }).join('');

    // Week grid
    const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
    const now = new Date();
    document.getElementById('week-grid').innerHTML = Array(7).fill(0).map((_, i) => {
        const d = new Date(now);
        d.setDate(d.getDate() - (6 - i));
        const key = d.toISOString().split('T')[0];
        const habits = data.habits[key] || {};
        const total = MORNING_HABITS.length + EVENING_HABITS.length + FOCUS_HABITS.length;
        const done = Object.keys(habits).filter(k => habits[k]).length;
        const pct = total > 0 ? (done / total) * 100 : 0;
        const isToday = key === today;
        return `<div class="card ${isToday ? 'card-gold' : ''}" style="text-align:center;padding:1rem">
            <div class="caption">${days[d.getDay()]}</div>
            <div style="font-size:1.5rem;margin:0.5rem 0">${pct >= 80 ? 'üü¢' : pct >= 40 ? 'üü°' : pct > 0 ? 'üü†' : '‚ö™'}</div>
            <div class="caption">${done}/${total}</div>
        </div>`;
    }).join('');
}

function toggleHabit(type, i) {
    const today = getTodayKey();
    if (!data.habits[today]) data.habits[today] = {};
    data.habits[today][`${type}_${i}`] = !data.habits[today][`${type}_${i}`];
    saveData();
    updateHabits();
    updateDashboard();
}

// ===== CAREER =====
function updateCareer() {
    document.getElementById('portfolio-tasks').innerHTML = PORTFOLIO_TASKS.map((t, i) => {
        const done = data.portfolioTasks[i];
        return `<div class="check-item ${done ? 'done' : ''}" onclick="togglePortfolio(${i})"><div class="check-box"></div><span class="check-text">${t}</span></div>`;
    }).join('');

    document.getElementById('linkedin-tasks').innerHTML = LINKEDIN_TASKS.map((t, i) => {
        const done = data.linkedinTasks[i];
        return `<div class="check-item ${done ? 'done' : ''}" onclick="toggleLinkedin(${i})"><div class="check-box"></div><span class="check-text">${t}</span></div>`;
    }).join('');

    document.getElementById('job-list').innerHTML = data.jobs.length ? data.jobs.map((j, i) => `
        <div class="card" style="margin-bottom:0.75rem">
            <div class="flex-between"><strong>${j.company}</strong><span class="caption">${j.status}</span></div>
            <p class="body-sm">${j.title}</p>
            <p class="caption">${j.salary}</p>
            <button class="btn btn-sm btn-ghost" style="margin-top:0.5rem" onclick="deleteJob(${i})">Remove</button>
        </div>
    `).join('') : '<p class="caption">No applications yet.</p>';

    document.getElementById('network-list').innerHTML = data.network.length ? data.network.map((n, i) => `
        <div class="card" style="margin-bottom:0.75rem">
            <div class="flex-between"><strong>${n.name}</strong><span class="caption">${n.company}</span></div>
            <p class="caption">${n.notes}</p>
            <button class="btn btn-sm btn-ghost" style="margin-top:0.5rem" onclick="deleteNetwork(${i})">Remove</button>
        </div>
    `).join('') : '<p class="caption">No connections logged yet.</p>';
}

function togglePortfolio(i) { data.portfolioTasks[i] = !data.portfolioTasks[i]; saveData(); updateCareer(); }
function toggleLinkedin(i) { data.linkedinTasks[i] = !data.linkedinTasks[i]; saveData(); updateCareer(); }

function addJob() {
    const company = document.getElementById('job-company').value.trim();
    const title = document.getElementById('job-title').value.trim();
    const status = document.getElementById('job-status').value;
    const salary = document.getElementById('job-salary').value.trim();
    if (!company) return alert('Enter company name');
    data.jobs.push({ company, title, status, salary });
    saveData();
    closeModal('job-modal');
    updateCareer();
}

function deleteJob(i) { data.jobs.splice(i, 1); saveData(); updateCareer(); }
function deleteNetwork(i) { data.network.splice(i, 1); saveData(); updateCareer(); }

function openJobModal() { openModal('job-modal'); }
function openNetworkModal() {
    // Quick inline modal for network
    const name = prompt('Contact name:');
    if (!name) return;
    const company = prompt('Company:') || '';
    const notes = prompt('Notes:') || '';
    data.network.push({ name, company, notes });
    saveData();
    updateCareer();
}

function openRestaurantModal() { openModal('restaurant-modal'); }

// ===== MODALS =====
function openModal(id) {
    document.getElementById(id).classList.add('open');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('open');
    // Clear inputs
    document.querySelectorAll(`#${id} input, #${id} textarea`).forEach(el => el.value = '');
}

// Close modal on backdrop click
document.querySelectorAll('.modal').forEach(m => {
    m.addEventListener('click', (e) => {
        if (e.target === m) closeModal(m.id);
    });
});

// ===== DATA MANAGEMENT =====
function exportData() {
    const exportObj = {
        version: 3,
        exportDate: new Date().toISOString(),
        data: data
    };
    const blob = new Blob([JSON.stringify(exportObj, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `life-hub-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    alert('Backup downloaded!');
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const imported = JSON.parse(e.target.result);

            // Handle both old format (direct data) and new format (wrapped with version)
            const newData = imported.data || imported;

            if (confirm('This will replace all your current data. Are you sure?')) {
                data = { ...data, ...newData };
                saveData();

                // Refresh all views
                updateDashboard();
                updateSpending();
                updateGoals();
                updateLearning();
                updateMeals();
                updateHabits();
                updateCareer();
                updateSettings();

                alert('Data imported successfully!');
            }
        } catch (err) {
            alert('Error reading backup file. Make sure it\'s a valid JSON file.');
            console.error(err);
        }
    };
    reader.readAsText(file);
    event.target.value = ''; // Reset file input
}

function resetAllData() {
    if (!confirm('Are you absolutely sure? This will delete ALL your data permanently!')) return;
    if (!confirm('Last chance! Export a backup first if you haven\'t already. Continue with reset?')) return;

    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem('life_hub_firebase');
    location.reload();
}

function updateSettings() {
    // Data stats
    document.getElementById('stat-expenses').textContent = data.expenses?.length || 0;
    document.getElementById('stat-habits').textContent = Object.keys(data.habits || {}).length;
    document.getElementById('stat-lessons').textContent = Object.keys(data.lessonsCompleted || {}).filter(k => data.lessonsCompleted[k]).length;

    const dataStr = JSON.stringify(data);
    const sizeKB = (new Blob([dataStr]).size / 1024).toFixed(1);
    document.getElementById('stat-size').textContent = sizeKB + ' KB';

    // Check Firebase connection
    const fbConfig = localStorage.getItem('life_hub_firebase');
    if (fbConfig && window.firebaseDb) {
        document.getElementById('sync-status').textContent = 'Connected';
        document.getElementById('sync-indicator').className = 'sync-dot online';
        document.getElementById('sync-detail').textContent = 'Your data syncs automatically across devices.';
        document.getElementById('firebase-setup').style.display = 'none';
        document.getElementById('firebase-connected').style.display = 'block';
        document.getElementById('firebase-config').value = fbConfig;
    } else if (fbConfig) {
        document.getElementById('firebase-config').value = fbConfig;
    }
}

// ===== FIREBASE INTEGRATION =====
let firebaseDb = null;
let firebaseRef = null;

async function loadFirebaseSDK() {
    if (window.firebase) return true;

    return new Promise((resolve) => {
        const script1 = document.createElement('script');
        script1.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js';
        script1.onload = () => {
            const script2 = document.createElement('script');
            script2.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js';
            script2.onload = () => resolve(true);
            script2.onerror = () => resolve(false);
            document.head.appendChild(script2);
        };
        script1.onerror = () => resolve(false);
        document.head.appendChild(script1);
    });
}

async function connectFirebase() {
    const configText = document.getElementById('firebase-config').value.trim();

    if (!configText) {
        alert('Please paste your Firebase config');
        return;
    }

    let config;
    try {
        config = JSON.parse(configText);
    } catch (e) {
        alert('Invalid JSON config. Please copy the exact config from Firebase console.');
        return;
    }

    // Check required fields
    if (!config.apiKey || !config.databaseURL) {
        alert('Config must include apiKey and databaseURL');
        return;
    }

    // Update indicator
    document.getElementById('sync-indicator').className = 'sync-dot syncing';
    document.getElementById('sync-status').textContent = 'Connecting...';

    try {
        // Load Firebase SDK
        const loaded = await loadFirebaseSDK();
        if (!loaded) throw new Error('Failed to load Firebase SDK');

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(config);
        }

        firebaseDb = firebase.database();

        // Generate or retrieve user ID for data isolation
        let userId = localStorage.getItem('life_hub_user_id');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('life_hub_user_id', userId);
        }

        firebaseRef = firebaseDb.ref('users/' + userId + '/data');

        // Test connection by reading data
        const snapshot = await firebaseRef.once('value');
        const cloudData = snapshot.val();

        if (cloudData) {
            // Cloud has data - ask user which to use
            const useCloud = confirm('Found existing data in cloud. Use cloud data? (Cancel to overwrite cloud with local data)');
            if (useCloud) {
                data = { ...data, ...cloudData };
                saveData();
            } else {
                await firebaseRef.set(data);
            }
        } else {
            // No cloud data - upload local data
            await firebaseRef.set(data);
        }

        // Save config
        localStorage.setItem('life_hub_firebase', configText);

        // Set up real-time sync
        setupFirebaseSync();

        // Update UI
        document.getElementById('sync-status').textContent = 'Connected';
        document.getElementById('sync-indicator').className = 'sync-dot online';
        document.getElementById('sync-detail').textContent = 'Your data syncs automatically across devices.';
        document.getElementById('firebase-setup').style.display = 'none';
        document.getElementById('firebase-connected').style.display = 'block';
        document.getElementById('last-sync').textContent = new Date().toLocaleTimeString();

        // Refresh views
        updateDashboard();
        updateSpending();
        updateGoals();
        updateLearning();
        updateMeals();
        updateHabits();
        updateCareer();

        alert('Connected to Firebase! Your data will now sync automatically.');

    } catch (err) {
        console.error('Firebase connection error:', err);
        document.getElementById('sync-indicator').className = 'sync-dot error';
        document.getElementById('sync-status').textContent = 'Connection Failed';
        document.getElementById('sync-detail').textContent = 'Error: ' + err.message;
        alert('Failed to connect: ' + err.message);
    }
}

function setupFirebaseSync() {
    if (!firebaseRef) return;

    // Listen for changes from cloud
    firebaseRef.on('value', (snapshot) => {
        const cloudData = snapshot.val();
        if (cloudData) {
            // Merge with local, preferring newer data
            const localStr = JSON.stringify(data);
            const cloudStr = JSON.stringify(cloudData);

            if (localStr !== cloudStr) {
                data = { ...data, ...cloudData };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

                // Refresh views
                updateDashboard();
                updateSpending();
                updateGoals();
                updateLearning();
                updateMeals();
                updateHabits();
                updateCareer();

                document.getElementById('last-sync').textContent = new Date().toLocaleTimeString();
            }
        }
    });

    // Override saveData to also sync to cloud
    const originalSave = saveData;
    window.saveData = function() {
        originalSave();
        if (firebaseRef) {
            firebaseRef.set(data).then(() => {
                const lastSync = document.getElementById('last-sync');
                if (lastSync) lastSync.textContent = new Date().toLocaleTimeString();
            }).catch(console.error);
        }
    };
}

function disconnectFirebase() {
    if (!confirm('Disconnect from Firebase? Your data will only be stored locally.')) return;

    localStorage.removeItem('life_hub_firebase');

    if (firebaseRef) {
        firebaseRef.off();
        firebaseRef = null;
    }
    firebaseDb = null;

    document.getElementById('sync-status').textContent = 'Not Connected';
    document.getElementById('sync-indicator').className = 'sync-dot offline';
    document.getElementById('sync-detail').textContent = 'Your data is only stored locally on this device.';
    document.getElementById('firebase-setup').style.display = 'block';
    document.getElementById('firebase-connected').style.display = 'none';

    // Restore original saveData
    window.saveData = function() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    };

    alert('Disconnected from Firebase.');
}

// Auto-connect to Firebase if config exists
async function autoConnectFirebase() {
    const savedConfig = localStorage.getItem('life_hub_firebase');
    if (savedConfig) {
        document.getElementById('firebase-config').value = savedConfig;
        await connectFirebase();
    }
}

// ===== INIT =====
init();
updateSettings();
autoConnectFirebase();
</script>
</body>
</html>
